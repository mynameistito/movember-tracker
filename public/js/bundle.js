var P={};var et="https://{subdomain}.movember.com/donate/details",St="14810348";var _=[1e3,2e3,4e3],At={uk:"GBP",au:"AUD",us:"USD",ca:"CAD",nz:"NZD",ie:"EUR",za:"ZAR",nl:"EUR",de:"EUR",fr:"EUR",es:"EUR",it:"EUR",ex:"EUR",cz:"CZK",dk:"DKK",se:"SEK"};function rt(t){return t&&At[t.toLowerCase()]||"AUD"}var Et={USD:"$",AUD:"$",CAD:"$",NZD:"$",GBP:"\xA3",EUR:"\u20AC",JPY:"\xA5",ZAR:"R",CZK:"K\u010D",DKK:"kr",SEK:"kr"};function ot(t){return t&&Et[t.toUpperCase()]||"$"}function nt(){return`${window.location.origin}/proxy`}var N=t=>{let r=Math.round(t/1e3),e=Math.floor(r/60),o=r%60;return e>0?`${e}m ${o}s (${t}ms)`:`${r}s (${t}ms)`},at=t=>new Promise(r=>setTimeout(r,t));var R={DEBUG:0,INFO:1,WARN:2,ERROR:3,NONE:4},w=R.INFO;function pt(){try{let r=localStorage.getItem("LOG_LEVEL");if(r){let e=r.toUpperCase();if(e in R){w=R[e];return}}}catch(r){typeof console<"u"&&console.warn&&console.warn("[LOGGER] localStorage unavailable, using default log level:",r instanceof Error?r.message:String(r))}w=window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"||window.location.search.includes("debug=true")?R.DEBUG:R.INFO}pt();function y(t,r,...e){return[`[${new Date().toISOString()}] [${t}] ${r}`,...e]}function L(t){return R[t]>=w}var it={setLevel(t){let r=t.toUpperCase();if(r in R){w=R[r];try{localStorage.setItem("LOG_LEVEL",r)}catch(e){try{it.warn("[LOGGER]","Failed to persist log level to localStorage:",e instanceof Error?e.message:String(e))}catch{typeof console<"u"&&console.warn&&console.warn("[LOGGER] Failed to persist log level:",e instanceof Error?e.message:String(e))}}}},getLevel(){for(let[t,r]of Object.entries(R))if(r===w)return t;return"INFO"},debug(t,...r){L("DEBUG")&&console.debug(...y("DEBUG",t,...r))},info(t,...r){L("INFO")&&console.log(...y("INFO",t,...r))},warn(t,...r){L("WARN")&&console.warn(...y("WARN",t,...r))},error(t,...r){L("ERROR")&&console.error(...y("ERROR",t,...r))}},a=it;var H=(t,r)=>{let e=t.trim(),o=r?rt(r):"AUD",n=e.replace(/[$€£¥]|\b(USD|EUR|GBP|AUD|JPY|CAD|NZD|ZAR)\b/gi,"").trim().match(/[\d,]+\.?\d*/);return{value:n?n[0]:"0",currency:o}},m=t=>{if(!t||typeof t!="string")return!1;let r=t.replace(/[,.\s$€£¥]/g,"");return!(!r||r.length===0||!/^\d+$/.test(r)||!/\d/.test(t)||/^[,.\s$€£¥]+$/.test(t))},st=(t,r)=>{let e=parseFloat(t.replace(/,/g,"")),o=parseFloat(r.replace(/,/g,""));return o===0?0:Math.round(e/o*100)};var ct={SUBDOMAIN:/https?:\/\/([^.]+)\.movember\.com/},E=[/\bGBP\b[\s:]*[\d,]+|[\d,]+[\s:]*\bGBP\b|British\s+Pound/i,/\bEUR\b[\s:]*[\d,]+|[\d,]+[\s:]*\bEUR\b|Euro[\s:]*[\d,]+/i,/\bUSD\b[\s:]*[\d,]+|[\d,]+[\s:]*\bUSD\b|US\s+Dollar/i,/\bAUD\b[\s:]*[\d,]+|[\d,]+[\s:]*\bAUD\b|Australian\s+Dollar/i,/\bCAD\b[\s:]*[\d,]+|[\d,]+[\s:]*\bCAD\b|Canadian\s+Dollar/i,/\bNZD\b[\s:]*[\d,]+|[\d,]+[\s:]*\bNZD\b|New\s+Zealand\s+Dollar/i,/\bZAR\b[\s:]*[\d,]+|[\d,]+[\s:]*\bZAR\b|South\s+African\s+Rand/i,/\bCZK\b[\s:]*[\d,]+|[\d,]+[\s:]*\bCZK\b|Czech\s+Koruna|Kč[\d,]+/i,/\bSEK\b[\s:]*[\d,]+|[\d,]+[\s:]*\bSEK\b|Swedish\s+Krona/i,/\bDKK\b[\s:]*[\d,]+|[\d,]+[\s:]*\bDKK\b|Danish\s+Krone/i],f={IRELAND:/Ireland|Irish/i,NETHERLANDS:/Netherlands|Dutch/i,GERMANY:/Germany|German/i,FRANCE:/France|French/i,SPAIN:/Spain|Spanish/i,ITALY:/Italy|Italian/i,UNITED_STATES:/United\s+States|US\s+Dollar/i,CANADA:/Canada|Canadian/i,NEW_ZEALAND:/New\s+Zealand/i,AUSTRALIA:/Australia|Australian/i},dt=/\$[\d,]+/,G=[/"AmountRaised"[^}]*"(?:convertedAmount|originalAmount)"["\s:]*["']([\d,]+(?:\.\d+)?)/i,/donationProgress--amount__raised[^>]*>([^<]*\$([\d,]+(?:\.\d+)?)[^<]*)/i,/class="[^"]*donationProgress--amount__raised[^"]*"[^>]*>[\s\S]*?\$([\d,]+(?:\.\d+)?)/i,/"(?:raised|raisedAmount|currentAmount)"[:\s]*["']?\$?([\d,]+(?:\.\d+)?)/i,/data-(?:raised|amount)=["']?\$?([\d,]+(?:\.\d+)?)/i,/donationProgress--amount__raised[^>]*>([^<]*[€£$]([\d,]+(?:\.\d+)?)[^<]*)/i,/donationProgress--amount__raised[^>]*>([^<]*(?:USD|EUR|GBP|AUD)\s*([\d,]+(?:\.\d+)?)[^<]*)/i],k=[/"target"[^}]*"fundraising"[^}]*"value"["\s:]*["']([\d,]+(?:\.\d+)?)/i,/donationProgress--amount__target[^>]*>([^<]*\$([\d,]+(?:\.\d+)?)[^<]*)/i,/class="[^"]*donationProgress--amount__target[^"]*"[^>]*>[\s\S]*?\$([\d,]+(?:\.\d+)?)/i,/"(?:target|targetAmount|goal)"[:\s]*["']?\$?([\d,]+(?:\.\d+)?)/i,/data-(?:target|goal)=["']?\$?([\d,]+(?:\.\d+)?)/i,/donationProgress--amount__target[^>]*>([^<]*[€£$]([\d,]+(?:\.\d+)?)[^<]*)/i,/donationProgress--amount__target[^>]*>([^<]*(?:USD|EUR|GBP|AUD)\s*([\d,]+(?:\.\d+)?)[^<]*)/i],K=[/"(?:raised|raisedAmount|currentAmount|donationAmount|amount)"[:\s]*["']?\$?([\d,]+(?:\.\d+)?)/i,/raised[:\s]*["']?\$?([\d,]+(?:\.\d+)?)/i],Y=[/"(?:target|targetAmount|goal)"[:\s]*["']?\$?([\d,]+(?:\.\d+)?)/i,/(?:target|goal)[:\s]*["']?\$?([\d,]+(?:\.\d+)?)/i],V=[/\$([\d,]+(?:\.\d+)?)\s*(?:raised|donated|collected)/i,/(?:raised|donated|collected)[:\s]*\$([\d,]+(?:\.\d+)?)/i,/<[^>]+class="[^"]*(?:amount|raised|donation|progress)[^"]*"[^>]*>\s*\$?([\d,]+(?:\.\d+)?)/i,/data-[^=]*amount[^=]*=["']?\$?([\d,]+(?:\.\d+)?)/i,/\$([\d,]+(?:\.\d+)?)\s*(?:of|out of)/i,/raised[:\s=]+[$]?([\d,]+(?:\.\d+)?)/i,/amount[:\s=]+[$]?([\d,]+(?:\.\d+)?)/i],Z=[/\$([\d,]+(?:\.\d+)?)\s*(?:target|goal)/i,/(?:target|goal)[:\s]*\$([\d,]+(?:\.\d+)?)/i,/<[^>]+class="[^"]*(?:target|goal)[^"]*"[^>]*>\s*\$?([\d,]+(?:\.\d+)?)/i,/data-[^=]*(?:target|goal)[^=]*=["']?\$?([\d,]+(?:\.\d+)?)/i,/\$([\d,]+(?:\.\d+)?)\s*(?:of|out of)\s*\$([\d,]+(?:\.\d+)?)/i,/target[:\s=]+[$]?([\d,]+(?:\.\d+)?)/i,/goal[:\s=]+[$]?([\d,]+(?:\.\d+)?)/i];function ut(t){let r="";for(let e=0;e<G.length;e++){let o=G[e],i=t.match(o);if(i){let n=i[i.length-1];if((!n||!m(n))&&i.length>2&&(n=i[i.length-2]),a.debug("[SCRAPE]",`Pattern ${e+1} matched, all groups:`,i.slice(1),`using: "${n}"`),m(n)){r=n,a.info("[SCRAPE]",`Found valid raised amount using pattern ${e+1}: ${r}`);break}else a.warn("[SCRAPE]",`Pattern ${e+1} matched but invalid number: "${n}", trying next pattern...`)}}if(!r){a.info("[SCRAPE]","Checking for JSON data in script tags...");let e=t.match(/<script[^>]*>([\s\S]*?)<\/script>/gi);if(e)for(let o of e){for(let i=0;i<K.length;i++){let n=K[i],s=o.match(n);if(s){let c=s[1];if(m(c)){r=c,a.info("[SCRAPE]",`Found valid raised amount in JSON using pattern ${i+1}: ${r}`);break}else a.warn("[SCRAPE]",`JSON raised pattern ${i+1} matched but invalid number: "${c}"`)}}if(r)break}}if(!r){a.info("[SCRAPE]","Trying generic dollar amount patterns as last resort...");for(let e=0;e<V.length;e++){let o=V[e],i=t.match(o);if(i){let n=i[1];if(m(n)){r=n,a.info("[SCRAPE]",`Found valid raised amount using generic pattern ${e+1}: ${r}`);break}else a.warn("[SCRAPE]",`Generic pattern ${e+1} matched but invalid number: "${n}"`)}}}if(!r){a.info("[SCRAPE]","Performing aggressive context-based search...");let e=[...t.matchAll(/\$([\d,]+(?:\.\d+)?)/g)];if(a.debug("[SCRAPE]",`Found ${e.length} dollar amounts in HTML`),e.length>0){let o=[];for(let i of e){let n=i[1];if(!m(n))continue;let s=i.index,c=Math.max(0,s-300),h=Math.min(t.length,s+i[0].length+300),u=t.substring(c,h).toLowerCase(),d=0;/(?:raised|donated|collected|current|funds?|progress|amount\s*(?:raised|donated))/i.test(u)&&(d+=10),/(?:has\s+raised|has\s+donated|has\s+collected|currently\s+raised)/i.test(u)&&(d+=5),/\$[\d,]+(?:\.\d+)?\s*(?:raised|donated|collected)/i.test(u)&&(d+=8),d>0&&o.push({amount:n,score:d,raisedScore:d,context:u.substring(0,200)})}if(o.sort((i,n)=>n.raisedScore-i.raisedScore),o.length>0){let i=o.filter(n=>n.raisedScore>0).sort((n,s)=>s.raisedScore-n.raisedScore);i.length>0&&(r=i[0].amount,a.info("[SCRAPE]",`Found raised amount via context search: ${r} (raisedScore: ${i[0].raisedScore})`))}}}return r}function lt(t){let r="";for(let e=0;e<k.length;e++){let o=k[e],i=t.match(o);if(i){let n=i[i.length-1];if((!n||!m(n))&&i.length>2&&(n=i[i.length-2]),a.debug("[SCRAPE]",`Target pattern ${e+1} matched, all groups:`,i.slice(1),`using: "${n}"`),m(n)){r=n,a.info("[SCRAPE]",`Found valid target amount using pattern ${e+1}: ${r}`);break}else a.warn("[SCRAPE]",`Target pattern ${e+1} matched but invalid number: "${n}", trying next pattern...`)}}if(!r){let e=t.match(/<script[^>]*>([\s\S]*?)<\/script>/gi);if(e)for(let o of e){for(let i=0;i<Y.length;i++){let n=Y[i],s=o.match(n);if(s){let c=s[1];if(m(c)){r=c,a.info("[SCRAPE]",`Found valid target amount in JSON using pattern ${i+1}: ${r}`);break}else a.warn("[SCRAPE]",`JSON target pattern ${i+1} matched but invalid number: "${c}"`)}}if(r)break}}if(!r){a.info("[SCRAPE]","Trying generic target amount patterns as last resort...");for(let e=0;e<Z.length;e++){let o=Z[e],i=t.match(o);if(i){let n=i[1];if(m(n)){r=n,a.info("[SCRAPE]",`Found valid target amount using generic pattern ${e+1}: ${r}`);break}else a.warn("[SCRAPE]",`Generic target pattern ${e+1} matched but invalid number: "${n}"`)}}}if(!r){let e=[...t.matchAll(/\$([\d,]+(?:\.\d+)?)/g)];if(e.length>0){let o=[];for(let i of e){let n=i[1];if(!m(n))continue;let s=i.index,c=Math.max(0,s-300),h=Math.min(t.length,s+i[0].length+300),u=t.substring(c,h).toLowerCase(),d=0;/(?:target|goal|aim|objective|of\s+\$)/i.test(u)&&(d+=10),/(?:target\s+(?:of|is)|goal\s+(?:of|is)|aim\s+(?:of|is))/i.test(u)&&(d+=5),/\$[\d,]+(?:\.\d+)?\s*(?:target|goal)/i.test(u)&&(d+=8),d>0&&o.push({amount:n,score:d,targetScore:d,context:u.substring(0,200)})}if(o.sort((i,n)=>n.targetScore-i.targetScore),o.length>0){let i=o.filter(n=>n.targetScore>0).sort((n,s)=>s.targetScore-n.targetScore);i.length>0&&(r=i[0].amount,a.info("[SCRAPE]",`Found target amount via context search: ${r} (targetScore: ${i[0].targetScore})`))}}}return r}function J(t,r,e){let o=Date.now();a.info("[SCRAPE]","Extracting data from HTML...");let i=ut(t),n=lt(t),s=Date.now()-o;return a.info("[SCRAPE]",`Data extraction completed in ${N(s)}`),a.debug("[SCRAPE]",`Raw extracted data for memberId ${r} (subdomain: ${e}):`,{raised:i||"NOT FOUND",target:n||"NOT FOUND"}),{raised:i,target:n}}function U(t){let r=t.match(ct.SUBDOMAIN);return r?r[1]:null}async function b(t){let r=`${nt()}?url=${encodeURIComponent(t)}`,e=await fetch(r);if(!e.ok){let n=`Proxy error! status: ${e.status}`;try{if(e.headers.get("content-type")?.includes("application/json")){let c=await e.json();c.message&&(n=c.message)}else{let c=await e.text();c&&(n=c.substring(0,200))}}catch(s){a.warn("[PROXY]","Could not parse error response:",s)}throw new Error(n)}let o=await e.text(),i=e.headers.get("X-Final-URL")||t;return{html:o,finalUrl:i}}function T(t,r){return`${et.replace("{subdomain}",r)}?memberId=${t}`}function z(t){try{let r=`movember:data:${t}`,e=localStorage.getItem(r);if(!e)return null;let{data:o,cachedAt:i,ttl:n}=JSON.parse(e);return Date.now()-i>n?(localStorage.removeItem(r),null):o}catch(r){return a.warn("[CACHE]","Error reading cached data:",r),null}}function O(t,r,e){try{let o=`movember:data:${t}`,i={data:r,cachedAt:Date.now(),ttl:e};localStorage.setItem(o,JSON.stringify(i))}catch(o){a.warn("[CACHE]","Error setting cached data:",o)}}function ft(t){try{let r=`movember:data:${t}`,e=localStorage.getItem(r);if(!e)return null;let{data:o,cachedAt:i}=JSON.parse(e),n=Date.now();return o?.subdomain?n-i>864e5?null:o.subdomain:null}catch(r){return a.warn("[CACHE]","Error reading cached subdomain:",r),null}}function p(t,r,e){try{let o=z(t);o||(o={}),o.subdomain=r,O(t,o,e)}catch(o){a.warn("[CACHE]","Error setting cached subdomain:",o)}}function W(t){try{let r=`movember:data:${t}`;localStorage.removeItem(r);let e=`movember:subdomain:${t}`;localStorage.removeItem(e);let o=`movember:amount:${t}`;localStorage.removeItem(o)}catch(r){a.warn("[CACHE]","Error clearing cached data:",r)}}function v(t){return t?t.includes("\xA3")||t.includes("&pound;")||t.includes("&#163;")?"uk":t.includes("\u20AC")||t.includes("&euro;")||t.includes("&#8364;")?t.match(f.IRELAND)?"ie":t.match(f.NETHERLANDS)?"nl":t.match(f.GERMANY)?"de":t.match(f.FRANCE)?"fr":t.match(f.SPAIN)?"es":t.match(f.ITALY)?"it":"ie":E[0].test(t)?"uk":E[1].test(t)?t.match(f.IRELAND)?"ie":t.match(f.NETHERLANDS)?"nl":t.match(f.GERMANY)?"de":t.match(f.FRANCE)?"fr":t.match(f.SPAIN)?"es":t.match(f.ITALY)?"it":"ie":E[2].test(t)?"us":E[3].test(t)?"au":E[4].test(t)?"ca":E[5].test(t)?"nz":E[6].test(t)?"za":E[7].test(t)?"cz":E[8].test(t)?"se":E[9].test(t)?"dk":dt.test(t)?t.match(f.UNITED_STATES)?"us":t.match(f.CANADA)?"ca":t.match(f.NEW_ZEALAND)?"nz":(t.match(f.AUSTRALIA),"au"):null:null}async function F(t,r=!1){if(r)a.info("[SUBDOMAIN]",`Force refresh requested, skipping cache for memberId ${t}`);else{let o=ft(t);if(o)return a.info("[SUBDOMAIN]",`Found cached subdomain for memberId ${t}: ${o}`),o}if(P[t]){let o=P[t];return a.info("[SUBDOMAIN]",`Using manual override for memberId ${t}: ${o}`),p(t,o,864e5),o}a.info("[SUBDOMAIN]",`Detecting subdomain for memberId ${t}...`);let e=["au","uk","us","ca","nz","ie","za","nl","de","fr","es","it","ex","cz","dk","se"];try{let o=null;for(let n of e){let s=T(t,n);try{let{html:c,finalUrl:h}=await b(s),u=U(h);if(c&&c.length>1e3){let d=v(c);if(u&&u!==n)return a.info("[SUBDOMAIN]",`URL redirected from ${n} to ${u} for memberId ${t}`),p(t,u,864e5),u;if(d===n||d===u){let g=u||n;return a.info("[SUBDOMAIN]",`Found matching subdomain for memberId ${t}: ${g} (verified by currency)`),p(t,g,864e5),g}else{if(d&&d!==n&&d!==u)return a.info("[SUBDOMAIN]",`HTML currency indicates ${d} (tested ${n}, final URL: ${u||n}), using detected subdomain`),p(t,d,864e5),d;{let g=u||n;o||(o=g,a.info("[SUBDOMAIN]",`Found valid HTML for subdomain ${g} (currency check inconclusive, storing as fallback)`))}}}}catch(c){a.warn("[SUBDOMAIN]","Error trying subdomain:",c)}}if(o)return a.info("[SUBDOMAIN]",`Using fallback subdomain for memberId ${t}: ${o} (no currency match found)`),p(t,o,864e5),o;let i=T(t,"au");try{let{html:n,finalUrl:s}=await b(i);if(n&&n.length>1e3){let c=U(s)||"au";return a.info("[SUBDOMAIN]",`Using default subdomain for memberId ${t}: ${c}`),p(t,c,864e5),c}}catch(n){a.warn("[SUBDOMAIN]","Error trying default subdomain:",n)}return a.warn("[SUBDOMAIN]",`Could not find working subdomain for memberId ${t}, using default: ${"au"}`),p(t,"au",864e5),"au"}catch(o){return a.warn("[SUBDOMAIN]",`Failed to detect subdomain for memberId ${t}, using default:`,o),p(t,"au",864e5),"au"}}async function j(t){return P[t]?P[t]:await F(t)}async function mt(t,r=!1){let e=await j(t),o=T(t,e),i=Date.now();a.info("[SCRAPE]",`Starting scrape of Movember page: ${o} (subdomain: ${e})`);try{a.info("[SCRAPE]",`Fetching HTML from ${o} via proxy...`);let n=Date.now(),s,c;try{let l=await b(o);s=l.html,c=l.finalUrl}catch(l){if(r&&l.message.includes("404")){a.warn("[SCRAPE]",`Got 404 for ${o}, clearing cached subdomain and re-detecting...`),W(t);let A=await F(t,!0);if(A!==e){a.info("[SCRAPE]",`Re-detected subdomain: ${A} (was ${e}), retrying with new subdomain...`);let B=T(t,A),tt=await b(B);s=tt.html,c=tt.finalUrl,e=A}else throw new Error("HTTP error! status: 404 (page not found - member may not exist)")}else throw l}let h=Date.now()-n;a.info("[SCRAPE]",`HTML fetched successfully in ${N(h)} (${s.length} characters)`);let u=U(c);u&&u!==e&&(a.info("[SCRAPE]",`URL redirected from ${e} to ${u}, updating subdomain...`),e=u,p(t,e,864e5));let d=v(s);d&&d!==e?a.warn("[SCRAPE]",`HTML currency indicates subdomain ${d} but URL subdomain is ${e}. Trusting URL subdomain (primary source).`):d===e&&a.info("[SCRAPE]",`HTML currency verification confirms subdomain ${e}`);let{raised:g,target:x}=J(s,t,e);if(!g||!m(g)){let l=s.match(/\$[\d,]+(?:\.\d+)?/g);a.warn("[SCRAPE]",`Found ${l?l.length:0} dollar amounts in HTML:`,l?l.slice(0,10):[]);let A=s.match(/[\d,]{3,}(?:\.\d+)?/g);a.warn("[SCRAPE]",`Found ${A?A.length:0} potential amount numbers in HTML (showing first 20):`,A?A.slice(0,20):[]);let B={memberId:t,subdomain:e,url:o,message:"Could not find raised amount in HTML. The page may require JavaScript execution or the HTML structure may have changed.",htmlLength:s.length,dollarAmountsFound:l?l.length:0,raisedValue:g||"empty"};throw a.error("[SCRAPE]","Failed to extract raised amount:",B),new Error(`Could not find raised amount in HTML for memberId ${t} (subdomain: ${e}). The page may require JavaScript execution or the HTML structure may have changed. Found ${l?l.length:0} dollar amounts in HTML.`)}if(!m(g))throw new Error(`Invalid raised value captured: "${g}" for memberId ${t}`);let{value:C,currency:q}=H(`$${g}`,e);(!C||C==="0"||C==="")&&a.warn("[SCRAPE]",`Parsed raised value is invalid: "${C}" from input: "${g}"`);let Q=ot(q),$={amount:`${Q}${C}`,currency:q,subdomain:e,timestamp:Date.now()};if(x&&m(x)){let{value:l}=H(`$${x}`,e),A=`${Q}${l}`;$.target=A,$.percentage=st(C,l)}else x&&a.warn("[SCRAPE]",`Target value "${x}" failed validation, skipping target`);let gt=Date.now()-i;return a.info("[SCRAPE]",`Scraping completed successfully in ${N(gt)}:`,{amount:$.amount,target:$.target,percentage:$.percentage,currency:$.currency,subdomain:$.subdomain}),$}catch(n){let s=Date.now()-i,c=n instanceof Error?n.message:String(n);throw a.error("[SCRAPE]",`Scraping failed after ${N(s)}:`,c,n),n}}async function X(t){let r=null,e=Date.now();a.info("[RETRY]",`Starting retry logic (max ${3} attempts) for memberId: ${t}`);for(let o=0;o<3;o++)try{a.info("[RETRY]",`Attempt ${o+1}/${3}`);let i=o===0||r?.message.includes("404"),n=await mt(t,i),s=Date.now()-e;return a.info("[RETRY]",`Success on attempt ${o+1} after ${s}ms`),n}catch(i){r=i instanceof Error?i:new Error(String(i));let n=r.message;if(a.error("[RETRY]",`Attempt ${o+1} failed:`,n),n.includes("404")&&(a.info("[RETRY]",`404 detected, clearing subdomain cache for memberId: ${t}`),W(t)),o<2){let s=_[o]||_[_.length-1];a.info("[RETRY]",`Waiting ${s}ms before retry ${o+2}...`),await at(s)}else{let s=Date.now()-e;a.error("[RETRY]",`All ${3} attempts failed after ${s}ms`)}}throw r||new Error("Failed to scrape after all retries")}async function Rt(t,r=!1){let e=null,o="HIT";if(r)a.info("[LIVE]",`grab-live parameter detected - forcing fresh scrape for memberId: ${t}`),e=await X(t),o="LIVE",a.info("[CACHE]",`Storing live data in cache with TTL: ${3e5}ms for memberId: ${t}`),O(t,e,3e5),a.info("[CACHE]","Live data stored successfully");else{if(a.info("[CACHE]",`Checking cache for memberId: ${t}`),e=z(t),e){let i=Date.now()-e.timestamp;a.info("[CACHE]",`Cache HIT - data age: ${Math.round(i/1e3)}s for memberId: ${t}`,{amount:e.amount,target:e.target,timestamp:new Date(e.timestamp).toISOString()})}else a.info("[CACHE]",`Cache MISS - need to scrape for memberId: ${t}`);e||(e=await X(t),o="MISS",a.info("[CACHE]",`Storing data in cache with TTL: ${3e5}ms for memberId: ${t}`),O(t,e,3e5),a.info("[CACHE]","Data stored successfully"))}return{data:e,cacheStatus:o}}export{St as DEFAULT_MEMBER_ID,T as buildMovemberUrl,F as detectSubdomainForMember,v as detectSubdomainFromHtml,J as extractAmounts,ut as extractRaisedAmount,U as extractSubdomainFromUrl,lt as extractTargetAmount,b as fetchViaProxy,Rt as getData,j as getSubdomainForMember,mt as scrapeMovemberPage,X as scrapeWithRetry};
//# sourceMappingURL=bundle.js.map
